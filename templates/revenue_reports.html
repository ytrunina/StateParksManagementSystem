<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Define the document type and language -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Link to an external stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Set the title of the page -->
    <title>Parks Revenue Dashboard</title>
    <!-- Define a function to filter a table based on user input -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('keyup', filterTable);
            function filterTable() {
                const filter = searchInput.value.toUpperCase();
                const table = document.getElementById('parksRevenueTable');
                const rows = table.getElementsByTagName('tr');

                for (let i = 1; i < rows.length; i++) {
                    const parkNameCell = rows[i].getElementsByTagName('td')[0];
                    const parkName = parkNameCell.textContent || parkNameCell.innerText;
                    if (parkName.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        });
    </script>
</head>
<body>
    <!-- Add a header with the title of the dashboard -->
    <h1>Parks Revenue Dashboard</h1>
    <!-- Add a welcome section with an introduction to the report -->
    <div class="welcome-section">
        <p class="intro">Here you can generate a comprehensive report that provides you with the total revenue generated from all the parks and the number of park passes sold.</p>
        <p>To generate the report, select start and end date and then simply click on the "Get Report" button, and the system will automatically compile all the relevant data from our parks' database. You will then see a detailed report with a breakdown of the revenue generated by each park, as well as the total revenue from all the parks combined.</p>
        <p>In addition to the revenue figures, the report will also provide you with the number of park passes sold. This information can be incredibly useful in tracking the performance of your parks, as well as helping you make informed decisions on future park operations and marketing strategies.</p>
        <p>We hope this report provides you with valuable insights into the revenue generated by your parks.</p>
    </div>
    <!-- Add a form to input start and end dates to generate the report -->
    <form method="GET" action="{{ url_for('revenue_reports') }}">
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" required>
        <label for="end_date">End Date:</label>
        <input type="date" id="end_date" name="end_date" required>
        <input type="submit" id="get_report_btn" value="Get Report">
        <input type="hidden" id="start_date_hidden" name="start_date" value="">
        <input type="hidden" id="end_date_hidden" name="end_date" value="">
    </form>
    <!-- Define a script to update a download link for the report -->

    <script>
        document.getElementById('get_report_btn').addEventListener('click', function() {
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const downloadLink = document.querySelector('a[href*="downloadpdf"]');
            downloadLink.href = downloadLink.href.replace(/start_date=[^&]+/, 'start_date=' + startDate).replace(/end_date=[^&]+/, 'end_date=' + endDate);
        });
    </script>
<!-- Add a search bar to filter the table by park name -->
    <input type="text" id="searchInput" placeholder="Search for park names...">
    <table id="parksRevenueTable">
        <thead>
            <tr>
                <th>Park Name</th>
                <th>Total Revenue</th>
                <th>Total Park Passes Purchased</th>
            </tr>
        </thead>
        <tbody>
            {% for park in parks %}
                <tr>
                    <td>{{ park.name }}</td>
                    <td>{{ park.total_revenue }}</td>
                    <td>{{ park.total_park_passes }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Display the total revenue for all parks -->
    <div>Total revenue for all parks: <span id="totalRevenue">{{ total_revenue }}</span></div>
    <!-- Show a download button for the report if start and end dates are entered -->
    {% if start_date and end_date %}
    <div style="text-align: center;">
        <p>Click the button below to download the park data as a PDF:</p>
        <a href="{{ url_for('downloadpdf', start_date=start_date, end_date=end_date) }}">
            <button class="download-btn">Download Park Data PDF</button>
        </a>
    </div>
    <!-- Add a style for the download button -->
    <style>
        .download-btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
{% endif %}
<!-- Define a function to sort the table rows based on the given column -->
<script>
    function sortTableBy(column) {
        // Declare variables to store the table, rows, and switching flag
        let table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("parksRevenueTable");
        switching = true;
    // Loop until there is no switching
    while (switching) {
        switching = false;
        rows = table.rows;
        // Loop through all the rows, except the header row
        for (i = 1; i < (rows.length - 1); i++) {
            shouldSwitch = false;
            // Get the cells of the current and next row for the given column
            x = rows[i].getElementsByTagName("TD")[column === 'Park' ? 0 : 1];
            y = rows[i + 1].getElementsByTagName("TD")[column === 'Park' ? 0 : 1];
            // If sorting by park name, compare the cell values in lowercase
            if (column === 'Park') {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    shouldSwitch = true;
                    break;
                }
            // If sorting by revenue, compare the cell values as floats
            } else {
                if (parseFloat(x.innerHTML) < parseFloat(y.innerHTML)) {
                    shouldSwitch = true;
                    break;
                }
            }
        }
        // If a switch is needed, swap the rows and set switching to true
        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
        }
    }
}
</script>
<button type="button" onclick="location.href='{{url_for('reports')}}'">Back</button>
</body>
</html>
